<html>
  <head>
    <title>Yearn-mini</title>
    <link rel="stylesheet" href="styles.css"></link>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <script src="./web3.min.js"></script>
    <script src="./bignumber.min.js"></script>
    <script src="./jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <script>
    let account;
    let apiUrl = 'https://api.yearn.finance/v1/chains/1/vaults/all';

    function toCurrency(x) {
      return '$ ' + x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function toPct(x) {
      return Math.round(x*10000)/100 + ' %';
    }

    window.onload = (function() {
      $.getJSON( apiUrl, function( data ) {
        var items = [];
        $.each( data, function( key, data ) {
          if (data.endorsed == true && data.type == "v2") {
            let ta = new BigNumber(data.tvl.total_assets).div(10**data.token.decimals).toFixed(2);
            

            items.push( "<tr><td>" 
              + "<a href=\"https://etherscan.io/address/" + data.address + "\" target=\"_blank\">"
              + data.display_name 
              + "</a>"
              + "</td><td>" 
              + toPct(data.apy.net_apy)
              + "</td><td>" 
              + toCurrency(ta) 
              + "</td></tr>" );
            
          }
        });

        $("#assetsRows").append(items.join("")); 

      });

      if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        ethereum.enable().then(() => {
          web3.eth.getAccounts().then((wallet) => {
            account = wallet[0];
            console.log(account);
            $("#yourWallet").append(": " + account)
          });
        });
      } else console.log('No web3 support :(\r\n\r\nTry running this file using: python -m http.server 8080');
    });
    </script>
    <div class="header">yearn-mini</div>
      <h2>All Vaults</h2>
      <table><thead><th>Name</th><th>APY</th><th>TVL</th><th></th></thead><tbody id="assetsRows"></tbody></table>
    </div>
  </body>
</html>
